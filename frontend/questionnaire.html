<html>
    <head>
        <title>Questionnaire</title>
        <link rel="stylesheet" href="participantstyle.css">
        <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="banner">
            <div class="box">
                <div style="padding: 2rem;" class="question" data-id="">
                </div>
            </div>
            <div id="disp" class="error" data-id="">
            </div>
        </div>
        <script>
            var questionmorph = [];
            var question;
            var id = 'P00';
            var i = 0;
            var nextquestionID;
            var isRequired;
            var error = 0;
            var choices;
            var apantisi;
            var currentquestionID;
            var optionID;
            $( document ).ready(function() {
                
                $.ajax({
                    type:"GET",
                    url:'http://localhost:9103/intelliq_api/question/QQ000/'+id+'',
                    crossDomain:true,
                    success: function(data2){
                        if(data2){
                            question = data2.qtext;
                            currentquestionID = data2.qID;
                            console.log(currentquestionID);
                            questionmorph = data2.options;
                            choices = questionmorph.length;
                            isRequired = data2.required === 'TRUE';
                            var isRequiredHTML = '';
                            if(isRequired){
                                isRequiredHTML = 'required';
                            }
                            var questiontype = questionmorph[0].optID;
                            if(questiontype.includes("TXT")){
                                nextquestionID = questionmorph[0].nextqID;
                                var html = '<h1>'+question+'</h1><div style="margin: 2rem;"><input '+isRequiredHTML+' type="text" id="'+questionmorph[0].optID+'" class="pedio"></input><button onclick="checkiffilled()" class="submit">Υποβολή</button></div>';
                            } else{
                                var html = '<h1>'+question+'</h1>';
                                while(i < choices){
                                    html += '<div style="margin: 2rem;"><input class="input" type="radio" id="'+questionmorph[i].optID+'" name="option" value="'+questionmorph[i].opttxt+'"><label class="label" for="option1" id="label1">'+questionmorph[i].opttxt+'</label><br>';
                                        i++;
                                }
                                i = 0;
                                html += '<button onclick="checkifselected()" id="press" class="submit">Υποβολή</button></div>';
                            }
                            $('.question').html(html);
                        }
                    }
                })
                
            });

            function checkiffilled(){
                apantisi = document.getElementById(questionmorph[0].optID).value;
                if (apantisi === "") {
                    document.getElementById("disp").innerHTML
                            = " field not filled";
                } else {
                    document.getElementById("disp").innerHTML
                                = "";
                    optionID = questionmorph[0].optID;
                    //saveanswer(apantisi, optionID)
                    nextquestion(nextquestionID);
                }
            }

            function checkifselected() {
                nextquestionID = questionmorph[0].nextqID;
                error = 0;
                for(var j=0; j<choices; j++){
                    if(document.getElementById(questionmorph[j].optID).checked) {
                        nextquestionID = questionmorph[j].nextqID;
                        apantisi = questionmorph[j].opttxt;
                        optionID = questionmorph[j].optID;
                        document.getElementById("disp").innerHTML
                                = ""; 
                        break;
                    }else{
                        error += 1;
                    }
                }
                if(error == choices){
                    if(isRequired){
                        document.getElementById("disp").innerHTML
                            = " radio button not checked"; 
                    }else {
                        optionID = null;
                        //savechoice(apantisi, optionID);
                        nextquestion(nextquestionID);
                    }
                }else{
                    //savechoice(apantisi, optionID);
                    nextquestion(nextquestionID);
                }
            }

            function savechoice(answer, optionID){
                $.ajax({
                        type:"POST",
                        url:'http://localhost:9103/intelliq_api/doanswer/QQ000/'+currentquestionID+'/1111/'+optionID+'',
                        crossDomain:true,  
                    });
            }

            function saveanswer(answer, optionID){
                $.ajax({
                        type:"POST",
                        url:'http://localhost:9103/intelliq_api/doanswer/QQ000/'+currentquestionID+'/1111/'+optionID+'',
                        crossDomain:true,  
                    });
            }
    
            function nextquestion(currentquestionID){
                if (currentquestionID == null){
                    var html = '<h1>Τελος ερωτηματολογίου.</h1>';
                    $('.question').html(html);
                }else{
                    $.ajax({
                        type:"GET",
                        url:'http://localhost:9103/intelliq_api/question/QQ000/'+currentquestionID+'',
                        crossDomain:true,
                        success: function(data2){
                            if(data2){
                                question = data2.qtext;
                                currentquestionID = data2.qID;
                                console.log(currentquestionID);
                                questionmorph = data2.options;
                                choices = questionmorph.length;
                                isRequired = data2.required === 'TRUE';
                                console.log(isRequired);
                                var isRequiredHTML = '';
                                if(isRequired){
                                    isRequiredHTML = 'required';
                                }
                                var questiontype = questionmorph[0].optID;
                                if(questiontype.includes("TXT")){
                                    nextquestionID = questionmorph[0].nextqID;
                                    var html = '<h1>'+question+'</h1><div style="margin: 2rem;"><input '+isRequiredHTML+' type="text" id="'+questionmorph[0].optID+'" class="pedio"></input><button onclick="checkiffilled()" class="submit">Υποβολή</button></div>';
                                } else{
                                    var html = '<h1>'+question+'</h1>';
                                    while(i < choices){
                                        html += '<div style="margin: 2rem;"><input class="input" type="radio" id="'+questionmorph[i].optID+'" name="option" value="'+questionmorph[i].opttxt+'"><label class="label" for="option1" id="label1">'+questionmorph[i].opttxt+'</label><br>';
                                            i++;                              
                                    }
                                    i = 0;
                                    html += '<button onclick="checkifselected()" class="submit">Υποβολή</button></div>';
                                }
                                
                                $('.question').html(html);
                            }
                        }
                    })
                }
            }

            
                
                    /*currentAnswer
                    currentResponse
                    $.ajax({
                        type:"POST",
                        url:'http://localhost:9103/intelliq_api/doanswer/QQ000/Q06/1111/Q06A1',
                        crossDomain:true,  
                    });
                    counter++;
                    questions[counter].type === 'profile'
                    an oxi */
    
                
        </script>
    </body>
    
</html>